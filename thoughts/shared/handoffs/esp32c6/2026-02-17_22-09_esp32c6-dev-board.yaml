---
session: esp32c6
date: 2026-02-17
status: partial
outcome: PARTIAL_PLUS
---

goal: Design ESP32-C6 dev board with USB, debug UART, GPIO header, mounting holes
now: Fix mounting holes (package needs atopile 0.14+, on 0.12.5) then add board outline

test: uvx --from atopile ato build

done_this_session:
  - task: Installed all parts via JLCPCB/ato CLI
    files: [parts/Espressif_Systems_ESP32_C6_MINI_1_N4/, parts/Korean_Hroparts_Elec_TYPE_C_31_M_12/, parts/UMW_AMS1117_3_3/, parts/WCH_CH340G/, parts/Yangxing_Tech_X322512MSB4SI/, parts/HONGLITRONIC_PSC_1608U52GC_G4/, parts/Slkor_1N5817W/, parts/BZCN_TSA061B2808B/, parts/chxunda_XD_XHD_2_4A/]
  - task: Designed full schematic in main.ato - power, USB, UART, LED, buttons, GPIO header
    files: [main.ato]
  - task: Build passes with 22/22 parts picked (before mounting holes)
    files: [layouts/default/default.kicad_pcb]
  - task: Added CLAUDE.md rule for MCP tool error reporting
    files: [CLAUDE.md]

blockers:
  - "atopile/mounting-holes package requires ^0.14.0 but project uses 0.12.5"
  - "fp-lib-table is regenerated by ato build, manual edits to add MountingHole lib get overwritten"

questions:
  - "Should we upgrade atopile to 0.14.x? (warning says 0.14.1004 available)"
  - "Or create a local mounting hole component with KiCad footprint from the package?"
  - "Is it safe to manually edit fp-lib-table if build regenerates it?"

decisions:
  - ch340g_5v: "Run CH340G at 5V (VCC=VBUS) with V3 internal 3.3V regulator, UART levels are 3.3V"
  - diode_or: "Two 1N5817W Schottky diodes OR the VBUS lines from both USB-C connectors"
  - gpio_header: "7 GPIOs (IO0-IO6) + GND on 2x4 header, all with 10k pullups"
  - passives_0603: "All passives 0603 except LDO caps (0805 for 10uF/22uF)"

findings:
  - mcp_tool_errors: "search_and_install_jlcpcb_part fails with AssertionError for many parts (LED C22371297, diode C5185908, connector C17700792, switch C20624994). Fallback: uvx --from atopile ato create part -s 'CXXXXXX' -a"
  - mcp_build_caching: "MCP build_project tool may return cached results; use ato build CLI for fresh builds"
  - fp_lib_table_regen: "ato build regenerates fp-lib-table, overwriting manual additions"

worked:
  - "ato create part -s CLI as fallback when MCP tool fails"
  - "bridge connect (~>) for passives is clean and works well"
  - "pin reference syntax (component.1, component.2) works for bare pin components"

failed:
  - "MCP search_and_install_jlcpcb_part - AssertionError on multiple parts"
  - "atopile/mounting-holes package - requires atopile 0.14+, import fails on 0.12.5"
  - "Manual fp-lib-table edit - overwritten by ato build"

next:
  - "Fix mounting holes: either upgrade atopile to 0.14+ OR create local component with copied footprint"
  - "Add 5x5cm board outline with rounded corners in kicad_pcb (Edge.Cuts layer)"
  - "Place 4 mounting holes at corners of board"
  - "Build and verify complete design"
  - "Consider adding auto-reset circuit (CH340G nDTR/nRTS -> transistors -> EN/IO9)"

files:
  created: [CLAUDE.md, parts/MountingHole_3_2_M3_Pad/MountingHole_3.2mm_M3_Pad.kicad_mod]
  modified: [main.ato, ato.yaml, layouts/default/fp-lib-table, layouts/default/default.kicad_pcb]

architecture: |
  USB-C #1 (usb_esp) -----> Diode 1N5817W --+---> AMS1117-3.3 ---> 3.3V rail
  USB-C #2 (usb_debug) ---> Diode 1N5817W --+        |                |
       |                         |                    5V rail          |
       |                    CH340G (5V)                               ESP32-C6-MINI-1-N4
       |                    + 12MHz crystal                            |  P3V3, EN, IO8(LED)
       |                    + 22pF load caps                           |  IO9(boot), IO12/13(USB)
       |                    TXD->RXD0, RXD<-TXD0                      |  RXD0/TXD0(UART)
       |                                                               |  IO0-IO6(header)
  D+/D- -> ESP32 IO12/IO13 (native USB)

  Buttons: Reset(EN->GND), Boot(IO9->GND)
  GPIO Header 2x4: GND + IO0-IO6 with 10k pullups
  Status LED: IO8 -> 1k resistor -> green 0603 LED
